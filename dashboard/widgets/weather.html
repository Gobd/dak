<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <base href="https://forecast.weather.gov/">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; background: transparent; overflow: hidden !important; }
    #container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    #loading { color: #666; font-family: sans-serif; }
    iframe { display: none; width: 100%; height: 100%; border: none; }
  </style>
</head>
<body>
  <div id="container">
    <div id="loading">Loading forecast...</div>
  </div>
  <iframe id="source"></iframe>
  <script>
    const iframe = document.getElementById('source');
    const loading = document.getElementById('loading');

    // Get lat/lon from URL args, with defaults
    const params = new URLSearchParams(window.location.search);
    const lat = params.get('lat') || '34.70083';
    const lon = params.get('lon') || '-119.31778';
    iframe.src = `https://forecast.weather.gov/MapClick.php?lat=${lat}&lon=${lon}`;

    iframe.onload = () => {
      try {
        const doc = iframe.contentDocument;
        if (!doc) {
          loading.textContent = 'Error: Cannot access iframe (cross-origin blocked)';
          return;
        }

        // Delete header, navbar, footer, misc UI elements
        doc.querySelectorAll('header, .navbar, footer, #no-view-options, .autocomplete-suggestions').forEach(el => el.remove());

        // Delete everything in .contentArea except #seven-day-forecast
        const contentArea = doc.querySelector('.contentArea');
        if (contentArea) {
          [...contentArea.children].forEach(child => {
            if (child.id !== 'seven-day-forecast') child.remove();
          });
        }

        // Inside #seven-day-forecast, keep only #seven-day-forecast-body
        const forecast = doc.getElementById('seven-day-forecast');
        if (forecast) {
          [...forecast.children].forEach(child => {
            if (child.id !== 'seven-day-forecast-body') child.remove();
          });
        }

        // Inject CSS to shrink images and overall height
        const style = doc.createElement('style');
        style.textContent = `
          html, body, main, .container, .contentArea, #seven-day-forecast, #seven-day-forecast-body {
            overflow: hidden !important;
            background: transparent !important;
            min-height: 100% !important;
          }
          #seven-day-forecast-body img.forecast-icon {
            width: 43px !important;
            height: 43px !important;
          }
          #seven-day-forecast-body .tombstone-container {
            height: auto !important;
            min-height: 0 !important;
            padding: 2px !important;
          }
          #seven-day-forecast-body .period-name {
            font-size: 11px !important;
          }
          #seven-day-forecast-body .temp {
            font-size: 12px !important;
          }
          #seven-day-forecast-body .short-desc {
            font-size: 10px !important;
            height: auto !important;
            min-height: 0 !important;
          }
          #seven-day-forecast-body #seven-day-forecast-list {
            padding-top: 10px !important;
          }
          #seven-day-forecast-body #headline-container {
            display: none !important;
          }
        `;
        doc.head.appendChild(style);

        // Show the cleaned iframe, hide our loading container
        document.getElementById('container').style.display = 'none';
        iframe.style.display = 'block';
      } catch (e) {
        loading.textContent = 'Error: ' + e.message;
      }
    };
  </script>
</body>
</html>
